<html lang=en">
<head>
  <title>Calculus: limit</title>
  <style>
    table, th, tr, td {
      border: 1px solid black
    }
    math {
      font-family: "Asana Math",serif
    }
  </style>
  <script type="text/javascript">
    function inlineMathToMathML(text) {
      // match inline math expression and replace with MathML
      // currently support
      // - fractions: must be in format (...)/(...). If no parentheses were given, will use +-() or whitespace to group
      // - power: e.g. x^2, (x+1)^2, (3x+1)^(2x)
      // - limit: the "approach" must be in parentheses
      text = text.replace(/lim *\((.+?)\)/g, "<munder><ms>lim</ms><mrow>$1</mrow></munder>");
      while (text.indexOf("integral") >= 0) {
        text = text.replace(/integral *\((.+?),(.+?)\)/g, "<munderover><mo>&int;</mo><mrow>$1</mrow><mrow>$2</mrow></munderover>");
      }
      // loop for nested power e.g. (x^3 + 2)^2
      while (text.indexOf("^") >= 0) {
        // has to do it this way because of how each open/close bracket has to be explicitly written in MathML
        text = text.replace(/\((.+?)\)\^\((.+?)\)/g, "<msup><mrow><mo>(</mo>$1<mo>)</mo></mrow><mrow><mo>(</mo>$2<mo>)</mo></mrow></msup>");
        text = text.replace(/\((.+?)\)\^([^+\-() ]+)/g, "<msup><mrow><mo>(</mo>$1<mo>)</mo></mrow><mrow>$2</mrow></msup>");
        text = text.replace(/([^+\-() ]+)\^\((.+?)\)/g, "<msup><mrow>$1</mrow><mrow><mo>(</mo>$2<mo>)</mo></mrow></msup>");
        text = text.replace(/([^+\-()<> ]+)\^([^+\-()<> ]+)/g, "<msup><mrow>$1</mrow><mrow>$2</mrow></msup>");
      }
      text = text.replace(/(?:([^+\-() ]+)|\((.+?)\))(?<!<)\/(?:([^+\-() ]+)|\((.+?)\))/g, "<mfrac><mrow>$1$2</mrow><mrow>$3$4</mrow></mfrac>");


      text = text.replace(/->|-&gt;/g, "→");
      text = text.replace(/inf|&infin;/g, "∞");
      text = text.replace(/([+\-*→(),=])/g, "<mo>$1</mo>");
      text = text.replace(/(\d+|∞)/g, "<mn>$1</mn>");
      text = text.replace(/(?<![a-z])([a-z])(?![a-z])/g, "<mi>$1</mi>");
      text = text.replace(/(?<![a-z])d([a-z])(?![a-z])/g, "<ms>&nbsp;d</ms><mi>$1</mi>");
      //text = text.replace(/\((.+?)\)\/\((.+?)\)/g, "<mfrac><mrow>$1</mrow><mrow>$2</mrow></mfrac>");
      return text;
    }

    function copy_text() {
      // Get the text field
      const copyText = document.getElementById("expression_text");

      // Select the text field
      copyText.select();
      copyText.setSelectionRange(0, 99999); // For mobile devices

      // Copy the text inside the text field
      navigator.clipboard.writeText(copyText.value);
      document.getElementById("copy_button").textContent = "copied!...";
      setTimeout(() => {
        document.getElementById("copy_button").textContent = "copy text";
      }, 3000);

    }

    function beautify_exp() {
      const new_ml_text = inlineMathToMathML(document.getElementById("expression").value);
      document.getElementById("expression_ml").innerHTML = new_ml_text;
      document.getElementById("expression_text").textContent = "<math>" + new_ml_text + "</math>";
    }

    window.onload = function () {
      beautify_exp();
    };
  </script>
</head>
<body>
<table>
  <tr>
    <th style="width:300px">Problem</th>
    <th style="width:300px">Answer</th>
  </tr>
  <tr>
    <td rowspan="2">
      <label for="expression"></label><input type="text" id="expression" style="width: 280px" spellcheck="false"
                                           value="lim(h->0) (f(x+h)-f(x))/h"/><br>
    </td>
    <td>
      beautiful:
      <math id="expression_ml"></math>
    </td>
  </tr>
  <tr>
    <td>
      MathML
      <button id="copy_button" onclick="copy_text()">copy text</button>
      <br> <label for="expression_text"></label><textarea id="expression_text" spellcheck="false"
                                                        style="width: 100%; height: 100px" readonly></textarea>
    </td>
  </tr>
</table>
<button id="toggle_button" onclick="beautify_exp() ">beautify!</button>
</body>
</html>

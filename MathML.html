<html lang=en">
<head>
  <title>Calculus: limit</title>
  <style>
    table, th, tr, td {
      border: 1px solid black
    }

    math {
      font-family: "Asana Math", serif
    }

    .over, .under {
      font-size: 50%
    }
  </style>
  <script type="text/javascript">
    function inlineMathToMathML(text) {
      // match inline math expression and replace with MathML
      // currently support
      // - fractions: must be in format (...)/(...). If no parentheses were given, will use +-() or whitespace to group
      // - power: e.g. x^2, (x+1)^2, (3x+1)^(2x)
      // - limit: the "approach" must be in parentheses
      // - differential: d must follow by exactly one a-z character
      // - integral: must be in the format: integral ($1, $2) where $1 and $2 are arbitrary expression. S1 will appear below and $2 above the integral sign
      // - from: the substitution vertical bar. Must be in format: from ($1, $2). Same rule as integral applies.
      // for the under/over of integral, from, and limit are generated with class="under" and class="over" by default. They do nothing, but will help you stylize it with CSS
      const integral_isunderover = document.getElementById("integral_isunderover").checked;
      const from_isunderover = document.getElementById("from_isunderover").checked;
      text = text.replace(/lim *\((.+?)\)/g, "<munder><ms>lim</ms><mrow class='under'>$1</mrow></munder>");
      while (text.indexOf("integral") >= 0) {
        if (integral_isunderover) {
          text = text.replace(/integral *\((.+?),(.+?)\)/g, "<munderover><ms>&int;</ms><mrow class='under'>$1</mrow><mrow class='over'>$2</mrow></munderover>");
        } else {
          text = text.replace(/integral *\((.+?),(.+?)\)/g, "<msubsup><ms>&int;</ms><mrow class='under'>$1</mrow><mrow class='over'>$2</mrow></msubsup>");
        }
      }
      while (text.indexOf("from") >= 0) {
        if (from_isunderover) {
          text = text.replace(/from *\((.+?),(.+?)\)/g, "<munderover><ms style='font-size: 100%'>|</ms><mrow class='under'>$1</mrow><mrow class='over'>$2</mrow></munderover>");
        } else {
          text = text.replace(/from *\((.+?),(.+?)\)/g, "<msubsup><ms style='font-size: 100%'>|</ms><mrow class='under'>$1</mrow><mrow class='over'>$2</mrow></msubsup>");
        }
      }
      // loop for nested power e.g. (x^3 + 2)^2
      while (text.indexOf("^") >= 0) {
        // has to do it this way because of how each open/close bracket has to be explicitly written in MathML
        text = text.replace(/\((.+?)\)\^\((.+?)\)/g, "<msup><mrow><mo>(</mo>$1<mo>)</mo></mrow><mrow><mo>(</mo>$2<mo>)</mo></mrow></msup>");
        text = text.replace(/\((.+?)\)\^([^+\-() ]+)/g, "<msup><mrow><mo>(</mo>$1<mo>)</mo></mrow><mrow>$2</mrow></msup>");
        text = text.replace(/([^+\-() ]+)\^\((.+?)\)/g, "<msup><mrow>$1</mrow><mrow><mo>(</mo>$2<mo>)</mo></mrow></msup>");
        text = text.replace(/([^+\-()<> ]+)\^([^+\-()<> ]+)/g, "<msup><mrow>$1</mrow><mrow>$2</mrow></msup>");
      }
      text = text.replace(/(?:([^+\-() ]+)|\((.+?)\))(?<!<)\/(?:([^+\-() ]+)|\((.+?)\))/g, "<mfrac><mrow>$1$2</mrow><mrow>$3$4</mrow></mfrac>");


      text = text.replace(/->|-&gt;/g, "→");
      text = text.replace(/(?<!\w\w)(?<=[a-z])'/g, "<mo>&prime;</mo>");
      text = text.replace(/inf|&infin;/g, "∞");
      text = text.replace(/([+\-*→(),=])(?!')/g, "<mo>$1</mo>");
      text = text.replace(/(\d+|∞)/g, "<mn>$1</mn>");
      text = text.replace(/(?<![a-z])([a-z])(?![a-z])/g, "<mi>$1</mi>");
      text = text.replace(/(?<![a-z])d([a-z])(?![a-z])/g, "<ms>&nbsp;d</ms><mi>$1</mi>");
      //text = text.replace(/\((.+?)\)\/\((.+?)\)/g, "<mfrac><mrow>$1</mrow><mrow>$2</mrow></mfrac>");
      return text;
    }

    function copy_text() {
      // Get the text field
      const copyText = document.getElementById("expression_text");

      // Select the text field
      copyText.select();
      copyText.setSelectionRange(0, 99999); // For mobile devices

      // Copy the text inside the text field
      navigator.clipboard.writeText(copyText.value);
      document.getElementById("copy_button").textContent = "copied!...";
      setTimeout(() => {
        document.getElementById("copy_button").textContent = "copy text";
      }, 3000);

    }

    function beautify_exp() {
      const new_ml_text = inlineMathToMathML(document.getElementById("expression").value);
      document.getElementById("expression_ml").innerHTML = new_ml_text;
      document.getElementById("expression_text").textContent = "<math>" + new_ml_text + "</math>";
    }

    window.onload = function () {
      beautify_exp();
    };
  </script>
</head>
<body>
<table>
  <tr>
    <th style="width:300px">Problem</th>
    <th style="width:300px">Answer</th>
  </tr>
  <tr>
    <td rowspan="2">
      <label for="expression"></label>
      <textarea id="expression" style="width: 280px;height: 100px"
                spellcheck="false">integral(x=0, 2) integral (y=1,4) lim(h->0) (f(x+h)-f(x))/h dy dx from(a=3,5)</textarea><br>
      <input type="checkbox" id="integral_isunderover" checked/><label for="integral_isunderover">use under/over for
      integral</label><br>
      <input type="checkbox" id="from_isunderover" checked/><label for="from_isunderover">use under/over for evaluation
      bound</label>
    </td>
    <td>
      beautiful:
      <math id="expression_ml"></math>
    </td>
  </tr>
  <tr>
    <td>
      MathML
      <button id="copy_button" onclick="copy_text()">copy text</button>
      <br> <label for="expression_text"></label><textarea id="expression_text" spellcheck="false"
                                                          style="width: 100%; height: 100px" readonly></textarea>
    </td>
  </tr>
</table>
<button id="toggle_button" onclick="beautify_exp() ">beautify!</button>
</body>
</html>
